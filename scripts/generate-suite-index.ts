import { readdirSync, writeFileSync, existsSync } from "fs";
import { join } from "path";

const suitesDir = join(process.cwd(), "src", "suites");

const suiteNames = readdirSync(suitesDir, { withFileTypes: true })
  .filter((d) => d.isDirectory())
  .filter((d) => existsSync(join(suitesDir, d.name, "suite.ts")))
  .map((d) => d.name)
  .sort();

const imports = suiteNames
  .map((name, i) => `import suite${i} from "./${name}/suite.js";`)
  .join("\n");

const entries = suiteNames
  .map((name, i) => `  "${name}": suite${i},`)
  .join("\n");

const content = `// Auto-generated by scripts/generate-suite-index.ts â€” do not edit
${imports}

const suites: Record<string, unknown> = {
${entries}
};

export default suites;
`;

writeFileSync(join(suitesDir, "index.ts"), content);
console.log(
  `Generated suite index: ${suiteNames.join(", ")} (${suiteNames.length} suites)`,
);
